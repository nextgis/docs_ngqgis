.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngq_vector_op:

Работа с векторными данными
===========================

Векторные операции можно запускать двумя способами:

* Старый способ: через меню Вектор.
* Новый способ: через модуль Processing (Инструменты анализа) --> Геоалгоритмы QGIS. 
Этим способом пользоваться удобнее. Некоторые инструменты доступны только в нём.

.. figure:: _static/vectortools_processing_ru.png
   :align: center
   :height: 16cm

   Инструменты работы с векторными данными в панели "Инструменты анализа". 
   

Операции, запускаемые через меню Вектор, как правило, генерируют новый Shape-файл на диске. 
А если их запускать через "Инструменты анализа", то они будут генерировать временные слои. Это удобнее. 

.. note:: В "Инструментах анализа" так же доступно огромное количество операций gdal, ogr, GRASS, SAGA, и из других источников, но они могут не запускаться. Операции из раздела "QGIS" работают надёжнее. 

Инструменты анализа векторных данных
----------------------------------------------

Эти инструменты работают с векторными слоями. Как правило, они создают новый слой. 
Эти инструменты не используют преобразование координат на лету, то есть нужно, чтобы входные слои 
были в одинаковой системе координат. Если инструмент рассчитывает расстояние, то ожидается, 
что слои будут в таких системах координат, где расстояния измеряются в метрах, например UTM.  
См. так же раздел :ref:`ngq_projections`.

Анализ ближайших соседей
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

На входе: точечный векторный слой.

Алгоритм выполняет анализ ближайших соседей для точечного слоя.
Вывод описывает, как распределяются ваши данные (кластеризуются, случайным образом или распределяются).
В результате генерируется HTML файл с вычисленной статистикой.

.. figure:: _static/vectortools_nearest_ru.png
   :align: center
   :name: vectortools_nearest_pic
   :width: 14cm

   Окно инструмента "Анализ ближайших соседей"

По умолчанию результаты сохраняются во временный файл, но можно задать его название и расположение нажав на три точки рядом с полем (см. :numref:`vectortools_nearest_pic`) и выбрав в выпадающем меню "Сохранить в файл".

Пример результатов анализа: 

Наблюдаемое среднее расстояние: 114.68516080952

Ожидаемое среднее расстояние: 1048.62303056732

Индекс ближайшего соседа: 0.10936738701

Число точек: 3117

Z-Счет: -95.12570270908

Матрица расстояний
^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор - пункт меню Анализ - Матрица расстояний:

.. figure:: _static/ngqgis_distance_matrix_ru.png
   :align: center
   :width: 14cm
 
   Инструмент для работы с векторными данными - Матрица расстояний

На входе: два точечных слоя.

Измеряет расстояние между точками двух точечных слоёв и выдает результат в виде:

1. Квадратной матрицы расстояний. 
2. Линейной матрицы расстояний. 
3. Суммы расстояний. 

Можно ограничить расчет только для k ближайших точек. Создаёт таблицу в формате CSV.

Сумма длинн
^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Сумма длинн:

.. figure:: _static/ngqgis_sum_of_distances_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Сумма длинн

На входе: слой полигонов + пересекающий его слой линий.

Алгоритм измеряет общую длину и общее количество линий, пересекающих каждый полигон для исходных полигонального и линейного слоев.

Результирующий слой копирует объекты исходного полигонального слоя с двумя дополнительными атрибутами, содержащими длину и количество пересекающих линий. Имена этих двух полей можно настроить в параметрах алгоритма. 

Например, есть полигональный слой территорий городов и линейный слой рек. Для каждого 
города будет рассчитана суммарная длинна рек на его территории. 

Подсчет точек в полигоне
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Подсчет точек в полигоне:

.. figure:: _static/ngqgis_number_of_points_in_polygons_ru.png
   :align: center
   :width: 14cm
 
   Инструмент для работы с векторными данными - Подсчет точек в полигоне
   
На входе: полигональный слой + точечный слой.

Рассчитывает число точек точечного слоя, которые находятся в пределах каждого полигона 
другого (векторного полигонального) слоя.

Результирующий слой копирует объекты исходного полигонального слоя с дополнительными полем, содержащим количество точек на каждом полигоне.

Имеется возможность выбрать статистический метод объединения атрибутов, если в точечном 
слое есть числовые атрибуты. 

Дополнительно можно указать поле веса каждой точки. В этом случае дополнительное результирующее поле будет содержать сумму весов точек, приходящихся на полигон.

Альтернативно можно указать поле классификации. Если задано, точки классифицируются по этому полю, и если в пределах полигона находится несколько точек с одинаковым значением поля, учитывается только одна из них. Таким образом, итоговый счетчик содержит количество различных классов, которые находятся в полигоне.

Одновременно нельзя использовать поле веса и поле класса, но если все таки заданы оба параметра, то будет использовано поле веса, а поле класса проигнорировано.


Пример: есть полигональный слой территорий городов и точечный слой железнодорожных 
станций. Для каждого города будет рассчитано количество находящихся в нём железнодорожных 
станций. 

.. figure:: _static/ngqgis_number_of_points_in_polygons_table.png
   :align: center
   :width: 12cm
 
   Пример результата подсчета точек в полигоне

Пример: есть полигональный слой районов города и точечный слой заведений общественного 
питания с количеством посадочных мест. Для каждого района будет добавленно два атрибута: 
количество находящихся в нём заведений общественного питания и сумма всех посадочных 
мест в районе или среднее число посадочных мест в этом районе. 

Список уникальных значений
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Список уникальных значений:

.. figure:: _static/ngqgis_list_of_unique_values_ru.png
   :align: center
   :width: 14cm
 
   Инструмент для работы с векторными данными - Список уникальных значений

Задаётся векторный слой и поле в нём. 

На выходе генерирует HTML-файл со списком всех уникальных значений для указанного поля атрибутивной 
таблицы исходного векторного слоя. 

Пример:

Всего уникальных значений:2

Уникальные значения:

way
relation

Базовая статистика
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Базовая статистика для полей:

.. figure:: _static/ngqgis_basic_statistics_ru.png
   :align: center
   :width: 14cm
 
   Инструмент для работы с векторными данными - Базовая статистика

Задаётся векторный слой и поле в нём. Можно указать режим "Только выделенные объекты".

Алгоритм генерирует базовую статистику значений поля в таблице атрибутов векторного слоя. Поддерживаются типы полей: числовые, дата, время и строковые. Рассчитывает основные статистики (среднее, стандартное отклонение, количество, сумму, коэффициент вариации) для указанного поля. Возвращаемая статистика зависит от типа поля.

Формат вывода - файл HTML.


Средние координаты
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Средние координаты:

.. figure:: _static/ngqgis_average_coordinates_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Средние координаты

Задаётся векторный слой любого типа.
Поле взвешивания (числовое), необязательно.
Поле признака классификации (любого типа), необязательно.

Рассчитывает среднеарифметические или средневзвешенные координаты центра для целого 
векторного слоя или для набора объектов, выбранного на основе уникальные значения 
из указанного поля.

Создаёт новый точечный слой.


Создать точки (центры пикселей) вдоль линий
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через панель Инструменты анализа в разделе "Вектор - создание":

.. figure:: _static/ngqgis_create_points_pixel_centers_ru.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Создать точки вдоль линий

Задаётся растровый слой и линейный слой.

Генерирует точки находящиеся в центрах пикселей, по которым проходит эта линия.

Создаёт новый точечный слой.

.. figure:: _static/ngqgis_points_along_line.png
   :align: center
   :width: 12cm
   
   Результат работы инструмента создания точек

Пересечения линий
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа или через меню Вектор ‣ Анализ ‣ Пересечение линий:

.. figure:: _static/ngqgis_intersection_of_lines_ru.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Пересечение линий.

На входе: два линейных векторных файла.

Алгоритм создает точечные объекты в местах пересечения линий исходного слоя и слоя пересечения. Полезен для определения мест пересечений дорог или водотоков. Игнорирует пересечения линий с длиной > 0. 

Создаёт новый точечный слой в формате ESRI Shapefile.

Выборка
-------

Запускается через панель Инструменты анализа в разделе "Вектор - Выборка".

Эти инструменты выделяют объекты в заданном слое по разным алгоритмам или создают 
новый Shapefile со сгенерированными объектами.

Случайное выделение
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через панель Инструменты анализа в разделе "Вектор - Выборка" или в меню Вектор ‣ Анализ ‣ Случайное выделение:

.. figure:: _static/ngqgis_random_sampling_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Случайное выделение

Задаётся исходный векторный слой (любого типа).

Случайно выбирает заданное число объектов слоя или заданный процент объектов слоя.

Алгоритм не создает новый слой.

Случайное выделение в подмножествах
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через панель Инструменты анализа в разделе "Вектор - Выборка" или в меню Вектор ‣ Анализ ‣ Случайное выделение в подмножествах:

.. figure:: _static/ngqgis_random_sampling_in_subsets_ru.png
   :align: center
   :width: 14cm
   
   Инструмент для работы с векторными данными - Случайное выделение в подмножествах
    
Алгоритм выбирает объекты в подмножествах (категориях) векторного слоя . Алгоритм не создает новый слой.

Случайно выбирает набор объектов с уникальными значением указанного поля так, чтобы 
с каждым значением выбралось одинаковое число объектов.

Значение доля/количество применяется не ко всему слою, а к каждой категории. Категории определяются в соответствии с заданным атрибутом.

Выбрать по расположению
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через панель Инструменты анализа в разделе "Вектор - Выборка":

.. figure:: _static/ngqgis_spatial_sample_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Выбрать по расположению
   
Выделяет объекты в одном слое, которые пересекают объекты в другом слое.
Можно выбирать, выделять ли объекты, которые касаются, пересекаются, полностью накладываются, 
находятся полностью внутри или наоборот, не пересекаются.
Можно выбирать: создавать новое выделение, добавлять к существующему выделению, 
убрать из текущего выделения, выбрать по этому правилу из объектов текущей выборки.

Выделить в пределах расстояния
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Алгоритм выделяет объекты векторного слоя, находящиеся в пределах указанного максимального расстояния от объектов другого слоя.

.. figure:: _static/ngqgis_extract_within_distance_ru.png
   :align: center
   :width: 14cm
   
   Инструмент для работы с векторными данными - Выделить в пределах расстояния


Инструменты создания векторных объектов
-------------------------------------

Случайные точки в границах слоя
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через через панель Инструменты анализа в разделе "Вектор - Создание" или в меню Вектор ‣ Анализ ‣ Случайные точки в границах слоя.

.. figure:: _static/ngqgis_random_points_layer_ru.png
   :align: center
   :width: 12cm

   Случайные точки в границах слоя

Задаётся исходный векторный слой (полигональный).

Cоздает псевдослучайные точки в пределах границ указанного слоя.

Можно задавать количество генерируемых точек, можно генерировать точки только внутри 
объектов полигонального слоя.

Создаёт новый точечный слой.

Слой генерируется в системе координат карты, будьте внимательны с преобразованием 
координат на лету.

Случайные точки в полигонах
^^^^^^^^^^^^^^^^^^^^^^^^

Алгоритм создает точечный слой, в котором точки случайным образом помещаются в полигоны входного полигонального слоя.

Операция запускается через через панель Инструменты анализа в разделе "Вектор - Создание" или в меню Вектор ‣ Анализ ‣ Случайные точки в полигонах.

.. figure:: _static/ngqgis_random_points_layer_ru.png
   :align: center
   :width: 14cm
   
   Случайные точки в полигонах

Можно задать следующие параметры:

**Минимальное расстояние между точками** и **глобальное минимальное расстояние** между точками.

.. note:: Точка не будет добавлена, если уже есть сгенерированная точка на этом (евклидовом) расстоянии от сгенерированного местоположения. Если задано минимальное расстояние между точками, то учитываются только точки в одном и том же полигональном объекте, в то время как если заданно глобальное минимальное расстояние между точками учитываются все ранее созданные точки. Если глобальное минимальное расстояние установлено равным или превышающим (локальное) минимальное расстояние, то последнее не действует.
Если минимальное расстояние слишком велико, то может оказаться невозможным создать указанное количество точек для каждого объекта, но все сгенерированные точки возвращаются.

**Максимальное количество попыток** на точку.

**Порождающее значение** для генератора случайных чисел (random seed - целое число, больше 0).

Можно **отключить наследование атрибутов** полигональных объектов результирующими точечными объектами (снять флажок пункта "Включить атрибуты полигона").

Общее количество точек будет равно количеству входных объектов помноженному на количество точек для каждого объекта, если не было пропущенных точек. Количество точек для каждого объекта, минимальное расстояние между точками и максимальное количество попыток на точку могут быть определены данными. 

Выходные данные алгоритма: 

* Количество объектов с пустой геометрией или без нее (FEATURES_WITH_EMPTY_OR_NO_GEOMETRY).
* Точечный слой, содержащий случайные точки (OUTPUT).
* Количество сгенерированных объектов (OUTPUT_POINTS). 
* Число пропущенных точек (POINTS_MISSED). 
* Количество объектов с непустой геометрией и пропущенными точками (POLYGONS_WITH_MISSED_POINTS).

Регулярные точки
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через через панель Инструменты анализа в разделе "Вектор - Создание" или в меню Вектор ‣ Анализ ‣ Регулярные точки.

.. figure:: _static/ngqgis_regular_points_ru.png
   :align: center
   :width: 14cm
 
   Инструмент для работы с векторными данными - Регулярные точки

Создаёт регулярную сетку точек в пределах указаной области и экспортирует их в 
точечный шейп-файл. Создаёт новый точечный слой.
Слой генерируется в системе координат карты, будьте внимательны с преобразованием 
координат на лету. Если вам нужно генерировать объекты с шагом, заданным в метрах, 
используйте соответствующие системы координат.
См. так же http://docs.nextgis.ru/docs_howto/source/grid_vertex_extract.html

Векторная сетка
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через через панель Инструменты анализа в разделе "Вектор - Создание" или в меню Вектор ‣ Анализ ‣ Создать сетку:

.. figure:: _static/ngqgis_regular_grid_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Создать сетку
   
Создаёт регулярную сетку из линий или полигонов в пределах указанной области **охвата**.

Сетка может быть сформирована точечными, линейными или полигональными **элементами** (прямоугольник, ромб, шестиугольник). Размер и/или расположение элементов сетки определяется горизонтальным и вертикальным **шагом**. 

Для слоя сетки нужно указать **систему координат**.

Значения охвата и шага сетки задаются в координатах и **единицах** этой СК. Если вам нужно генерировать объекты с шагом заданных в метрах, используйте соответствующие системы координат. 

Точкой привязки сетки является левый верхний угол (minX, maxY). Это означает, что в этой точке гарантированно будет размещен элемент сетки. Если ширина и высота охвата не кратны заданному шагу, то совсем не обязательно что в этот экстент попадут еще элементы.

Создаёт новый слой.

См. так же http://docs.nextgis.ru/docs_howto/source/grid_vertex_extract.html


Полигон из границ слоя
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Выборка - Полигон из границ слоя:

.. figure:: _static/ngqgis_polygon_from_the_boundary_layer.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Полигон из границ слоя.

Создаёт полигональный слой с прямоугольным полигоном в соответствии с границами 
исходного растрового или векторного слоя. Так же может создавать отдельный полигон 
для каждого отдельного объекта. Создаёт новый слой.

Геообработка
------------

Операция запускается через пункт меню Вектор ‣ Геообработка.

.. figure:: _static/vector_geoobrabotka_menu_ru.png
   :align: center
   :width: 18cm
   
   Выпадающее меню Геообработка

Буферные зоны
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Геообработка ‣ Буфер:

.. figure:: _static/ngqgis_buffer_zones_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Буфер

Создает буферные зоны вокруг объектов заданного пользователем размера или используется 
размер из значений указанного поля.

Для задания буферных зон в метрах требуется, чтобы слой был в системе координат, 
которая считается в метрах. Создаёт новый слой.

.. tip:: Если создать очень маленький буфер для полигонального слоя, то можно таким образом 
убрать в нём ошибки геометрии. 

Можно настроить следующие параметры инструмента:

* 'сегменты' используется для задания количества отрезков, аппроксимирующих четверть окружности при создании скруглений.
* 'стиль торцов' указывает стиль буферизации торцов линий.
* 'стиль сопряжения' указывает, каким образом должны буферизоваться сопряжения линий - скруглением, фаской или углом.
* 'предел острия' применим только для углового сопряжения в случае острого угла и указывает максимальное разрешенное расстояние вершины угла от буфера.

.. figure:: _static/vectortools_buffers_source1.png
   :align: center
   :height: 16cm

   Исходный точечный слой, для которого строятся буферные зоны


.. figure:: _static/vectortools_buffers_result1.png
   :align: center
   :height: 16cm

   Буферные зоны

Пересекающиеся буферные зоны можно объединить, для этого нужно поставить флажок в пункте "Результат объединения".
   
.. figure:: _static/vectortools_buffers_result2.png
   :align: center
   :height: 16cm
   
   Буферные зоны - результат объединения
   
Выпуклая оболочка
^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Геообработка ‣ Выпуклая оболочка:

.. figure:: _static/ngqgis_convex_shells_ru.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Выпуклая оболочка

Создает минимально возможные выпуклые оболочки, покрывающие весь слой или сгруппированные подмножества объектов, или выпуклые оболочки на основе указанного поля. 

Создаёт новый слой.

.. figure:: _static/vectortools_convex_hull_layer1.png
   :align: center
   :height: 10cm
   
   Исходный слой
   
.. figure:: _static/vectortools_convex_hull.png
   :align: center
   :height: 10cm

   Выпуклая оболочка, сгенерированная для полигонального слоя
  

Пересечение
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Инструменты пространственных операций") или через пункт меню Вектор ‣ Геообработка ‣ Пересечение:

.. figure:: _static/ngqgis_crossing.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Пересечение

Совмещает слои таким образом, что в выходном слое содержатся только участки, в которых 
оба слоя пересекаются. Создаёт новый слой.

.. figure:: _static/vectortools_intersect_ru.png
   :align: center
   :height: 7cm

   Результат пересечения Рыбинского водохранилища и Ярославской области - территория 
   Рыбинского водохранилища, попадающая в Ярославскую область

   .. http://trolleway.nextgis.com/api/component/render/image?resource=553,554,471&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433

Инструмент "Пересечение" в результирующем слое создаёт атрибуты из обоих исходных слоёв. 

Объединение
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Инструменты пространственных операций") или через пункт меню Вектор ‣ Геообработка ‣ Объединение:

.. figure:: _static/ngqgis_integration_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Объединение

Совмещает слои таким образом, что в выходном слое содержатся как участки пересечения, 
так и участки, принадлежащие только одному из слоев. Создаёт новый Shapefile.


.. figure:: _static/vectortools_union.png
   :align: center
   :height: 7cm

   Результат объединения Рыбинского водохранилища и Ярославской области - территория 
   и области, и всего водохранилища. 
   
.. http://trolleway.nextgis.com/api/component/render/image?resource=553,554,473&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433

Обрезать
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Инструменты пространственных операций") или через пункт меню Вектор ‣ Геообработка ‣ Обрезать:

.. figure:: _static/ngqgis_clipping_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Обрезка

Совмещает слои таким образом, что в выходном слое содержатся только те участки, 
которые пересекаются со слоем отсечения.

Создаёт новый слой.

.. figure:: _static/vectortools_clip.png
   :align: center
   :height: 7cm

   Результат обрезки. 
 
.. http://trolleway.nextgis.com/api/component/render/image?resource=553,554,467&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433

Инструмент в результирующем слое создаёт атрибуты только из исходного слоя. 

Разность
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Инструменты пространственных операций") или через пункт меню Вектор ‣ Геообработка ‣ Разность:

.. figure:: _static/ngqgis_difference_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Разность

Совмещает слои таким образом, что в выходном слое содержатся только те участки, 
которые **не** пересекаются со слоем отсечения. Создаёт новый слой.

.. figure:: _static/vectortools_difference.png
   :align: center
   :height: 7cm
   
   Результат разности
   
.. http://trolleway.nextgis.com/api/component/render/image?resource=553,554,475&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433


Симметричная разность
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Инструменты пространственных операций") или через пункт меню Вектор ‣ Геообработка ‣ Симметричная разность:

.. figure:: _static/ngqgis_symmetrical_difference_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Симметричная разность

Совмещает слои таким образом, что в выходном слое содержатся только те участки, 
в которых исходные слои не пересекаются. Создаёт новый слой.

.. figure:: _static/vectortools_symmetrical_difference.png
   :align: center
   :height: 7cm
   
   Результат симметричной разности
   
.. http://trolleway.nextgis.com/api/component/render/image?resource=553,554,477&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433

Объединение по признаку
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Геообработка ‣ Объединение по признаку:

.. figure:: _static/ngqgis_unification_on_the_basis_of_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Объединение по признаку

Объединяет объекты на основе значения указанного поля. Все объекты исходного слоя быть могут объединены в один. Или может быть задан один или несколько атрибутов классификации (класс - объекты с одинаковым значением атрибута) - все объекты с одинаковым значением поля будут объединены в один объект.

Создаёт новый слой.

Выходные геометрии становятся составными (мультигеометрии). В случае полигонального слоя - смежные границы объединяемых объектов удаляются.

Удалить выбранные полигоны (присоединить к соседним)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Геообработка ‣ Удалить выбранные полигоны (присоединить к соседним):

.. figure:: _static/ngqgis_fragmentation_polygons_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Удаление осколочных полигонов

Алгоритм сливает выбранные полигоны исходного слоя с некоторыми смежными полигонами путем стирания их общей границы. Смежным полигоном может быть либо полигон с наибольшей или наименьшей площадью, либо полигон, имеющий наибольшую общую границу. Алгоритм обычно используется для избавления от осколочных полигонов, т. е. крошечных полигонов, которые являются результатом пересечения полигонов, где границы входных данных похожи, но не идентичны.

Создаёт новый слой.

Обработка геометрии
-------------------------------------

Операция запускается через пункт меню Вектор ‣ Обработка геометрии:

.. figure:: _static/vector_geometry_menu_ru.png
   :align: center
   :width: 18cm
   
   Выпадающее меню Обработка геометрии

Проверка геометрии
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Проверка геометрии:

.. figure:: _static/ngqgis_geometry_check_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Проверка геометрии

Проверяет полигоны на наличие пересечений, «островов» и неправильного порядка нумерации 
узлов.

Создает три слоя:

* Слой корректных объектов
* Слой некорректных объектов
* Слой ошибок

Добавить атрибуты геометрии
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Добавить атрибуты геометрии:

.. figure:: _static/ngqgis_export_geometry_field_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Добавить атрибуты геометрии

Алгоритм вычисляет геометрические свойства объектов векторного слоя. 

В результате генерируется новый векторный слой с тем же содержимым, что и исходный, но с дополнительными атрибутами в таблице, содержащими геометрические измерения.

В зависимости от типа геометрии векторного слоя атрибуты, добавляемые в таблицу, будут отличаться:

* (XCOORD, YCOORD) для точечного слоя
* (LENGTH) для линейного 
* (AREA, PERIMETER) для полигонального

Длины и площади будут рассчитаны в единицах координат слоя.

Центроиды полигонов
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Центроиды:

.. figure:: _static/ngqgis_centroids_of_polygons_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Центроиды

Вычисляет истинные центроиды для каждого полигона исходного полигонального слоя.

Создает новый точечный слой. Атрибуты производных объектов целевого слоя наследуются от родительских объектов исходного слоя.

.. figure:: _static/vectortools_centroids.png
   :align: center
   :height: 7cm
   
   Результат генерации центроидов для 4 полигонов
   
.. http://trolleway.nextgis.com/api/component/render/image?resource=1032,1034&extent=3997962.3274278585,7692622.5266201375,5069303.715872889,8220955.266127276&size=877,433


Триангуляция Делоне
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Триангуляция Делоне:

.. figure:: _static/ngqgis_Delaunay_triangulation.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Триангуляция Делоне

Рассчитывает и строит (как полигональный слой) триангуляцию Делоне для исходного 
точечного слоя.
Создаёт новый слой.

.. figure:: _static/ex_triangulation_points.png
   :align: center
   :width: 12cm
 
   Исходный точечный слой

.. figure:: _static/ex_triangulation_result.png
   :align: center
   :width: 12cm
 
   Результат триангуляции

Полигоны Вороного 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Полигоны Вороного:

.. figure:: _static/ngqgis_polygons_of_Voron_ru.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Полигоны Вороного

Генерирует полигоны Вороного для исходного точечного слоя.
Создаёт новый слой.

.. figure:: _static/ex_triangulation_points.png
   :align: center
   :width: 12cm
 
   Исходный точечный слой

.. figure:: _static/ex_voronoy_polygons.png
   :align: center
   :width: 12cm
 
   Полигоны Вороного

Упростить геометрию
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Упростить:

.. figure:: _static/ngqgis_simplify_geometry_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Упростить

Упрощает линии или полигоны. В результате создается новый слой с теми же объектами, что в исходном слое, но геометрии содержат меньшее количество вершин.

Предлагается на выбор три метода упрощения:

* алгоритм Дугласа-Пекера (базирующийся на линейном допуске)
* алгоритм Висвалингама (базирующийся на площадном допуске)
* привязка геометрии к координатной сетке


Добавить вершины
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Добавить вершины:

.. figure:: _static/ngqgis_add_vertices_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Добавить вершины

Добавляет дополнительные вершины к объектам линейного или полиногнального слоя. Число новых вершин, добавляемых в геометрии задается параметром.

Создается новый слой - версия исходного линейного или полигонального слоя с увеличенным числом вершин.

Если геометрия имеет измерения z или m, то значения в этих измерениях будут линейно интерполированы в добавленных узлах.

.. figure:: _static/ex_add_vertices.png
   :align: center
   :width: 12cm
   
   Число добавленных вершин - 10. Вершины полигона в режиме редактирования подсвечены красным 


Разбить составную геометрию
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Разбить составную геометрию:

.. figure:: _static/ngqgis_break_up_a_composite_geom_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Разбить составную геометрию.

Преобразует составные объекты (мульти-полигоны или мульти-полилинии) в несколько 
простых объектов (полигонов или полилиний).

Каждый объект с составной геометрией делится на столько простых объектов, сколько частей содержит исходная геометрия, и для каждого из них используются одни и те же исходные атрибуты.

Создает новый слой.

Собрать геометрии
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Собрать геометрии:

.. figure:: _static/ngqgis_integrate_geometry_into_a_composite_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Собрать геометрии
   
Алгоритм собирает объекты векторного слоя в новый составной объект. 

Можно указать один или несколько атрибутов для сбора объектов, принадлежащих только к одному классу (имеющих одинаковое значение для указанных атрибутов), или же можно собрать все объекты.

Тип геометрии целевого объекта будет преобразован в составной тип, даже если и состоит из одного исходного объекта. 

Данный алгоритм не объединяет перекрывающиеся геометрии, в отличие от инструмента "Объединение по признаку" - они будут собраны вместе без изменения формы каждого исходного объекта.

См. алгоритмы 'Агрегировать' или 'Преобразовать в составные' как альтернативы с иными возможностями.

Преобразовать полигоны в линии
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Полигоны в линии:

.. figure:: _static/ngqgis_convert_polygons_to_lines_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Полигоны в линии

Преобразует полигоны в линии, составные полигоны преобразует в несколько простых 
полилиний.

Преобразовать линии в полигоны
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Линии в полигоны:

.. figure:: _static/ngqgis_converting_line_into_polygons_ru.png
   :align: center
   :width: 14cm

   Инструмент для работы с векторными данными - Линии в полигоны

Преобразует линии в полигоны, составные линии преобразует в несколько простых полигонов.

Создаёт новый слой. Таблица атрибутов копируется в выходной слой без изменений.

Извлечь вершины
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается из панели Инструменты анализа (раздел "Вектор - Геометрия") или через пункт меню Вектор ‣ Обработка геометрии ‣ Извлечь вершины:

.. figure:: _static/ngqgis_node_extraction_ru.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Извлечь вершины

Извлекает узлы из линий или полигонов, создавая точечный слой.

Атрибуты точек наследуются от родительских объектов исходного слоя.

К точке добавляются дополнительные поля, содержащие индекс вершины (начиная с 0), часть, которой принадлежит вершина и ее индекс внутри части (или контура в случае полигонов), расстояние вдоль исходной геометрии и угол при вершине.

Общие инструменты для работы с векторами
---------------------------------------------

Операция запускается через пункт меню Вектор - пункт меню Управление данными.

Задать текущую проекцию
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Управление данными - Задать текущую проекцию:

.. figure:: _static/ngqgis_set_the_current_projection.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Задать текущую проекцию.

Задает проекцию для шейп-файла, если ранее она не была задана.

Объединение атрибутов по районам
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Управление данными - Объединение атрибутов по районам:

.. figure:: _static/ngqgis_aggregation_of_attributes_by_area.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Объединение атрибутов по районам.

Присоединяет дополнительные атрибуты к векторному слою на основе пространственного 
взаимного расположения. Атрибуты из одного векторного слоя присоединяются к атрибутивной 
таблице другого векторного слоя и экспортируются в слой.

Разбить векторный слой
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Управление данными - Разбить векторный слой:

.. figure:: _static/ngqgis_split_the_vector_layer.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Разбить векторный слой.

Делит векторный слой на несколько отдельных слоев на основе значения указанного 
поля.

Объединить векторные слои
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Управление данными - Объединить векторные слои:

.. figure:: _static/ngqgis_combining_shapefiles.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Объединить векторные слои.

Объединяет несколько векторных слоёв в один (можно выбирать больше двух).
 	
Создать пространственный индекс
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через пункт меню Вектор - пункт меню Управление данными - Создать пространственный индекс:

.. figure:: _static/ngqgis_create_a_spatial_index.png
   :align: center
   :width: 12cm

   Инструмент для работы с векторными данными - Создать пространственный индекс.

Создать пространственный индекс для форматов, поддерживаемых OGR. Он сохраняется 
посредством OGR.

Ориентированный охватывающий прямоугольник
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Oriented minimum bounding box

Для каждого обьекта строит охватывающий прямоугольник, который повёрнут так, чтобы 
получалась меньшая площадь. В атрибуты записываются: 

* площадь,
* угол,
* периметр,
* длина,
* ширина.

.. figure:: _static/vectortools_Oriented_MBBox.png
   :align: center
   :width: 16cm

   Ориентированные охватывающие прямоугольники, построенные для слоя территорий городов.

Сетевой анализ - зона охвата
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Service area

Будет доступно с версии 3

Задаётся линейный слой представляющий граф, и точечный слой. Инструмент создаёт линейный слой, который состоит из тех линий, что находятся в пределах заданного расстояния или времени по графу. Можно выбрать режим расчёта: по времени или по дистанции, максимальное значение задаётся в поле travel_cost. Так же можно указывать, из каких атрибутов берётся направление и скорость для участка графа.
Инструмент нормально работает, если слои в метрах (UTM). Точки не обязательно должны прилипать к дороге.

.. figure:: _static/vectortools_service_area.png
   :align: center
   :width: 16cm

   Слой сгенерированый инструментом service area.
   
Пиксели в точки, пиксели в полигоны
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Принимает на вход растр, генерирует векторный слой с точками в центре пикселов растра. 

.. figure:: _static/vectortools_pixels_to_points.png
   :align: center
   :width: 16cm

   Слой сгенерированый инструментом пикселы в точки.
   
Окно "Инструменты анализа"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Это более новый способ запуска операций геообработки. Раньше инструменты запускались через меню "Вектор", теперь добавилось это окно. В нём доступно больше операций.

Отличительные особенности processing:

* Результат работы модулей - временные слои. Это удобно тем, что у вас не появляются кучи файлов. 
  Так же можно сохранять результат в файлы.
* Можно обрабатывать данные, содержащиеся во временных слоях.
* Текстовый поиск названий модулей.
* В одном месте видны так же и модули из пакетов Saga, GDAL и других дополнительных плагинов.
* Модели - сохранение последовательности операций.

При идентификации, если включён режим "открывать форму", то при нажатии на несколько объектов 
по очереди выделение может не сниматься. Это не является ошибкой: где-то на дисплее остаются 
открытые окна идентификации, вот они и остаются красные. 


