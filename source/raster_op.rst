.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngqgis_raster_op:



Работа с растровыми данными
===========================

В этом разделе описывается вопросы визуализиции и определения свойств растрового слоя. 
QGIS использует библиотеку GDAL для чтения и записи растровых форматов. 
Растр поддержка GRASS поставляется нативной QGIS плагин поставщика данных. Растровые 
данные также могут быть загружены в режиме чтения из почтового индекса и GZIP архивов в QGIS.

Перечисленные операции выполняются модулем gdalTools. По умолчанию он установлен. 
Если вы не находите этих пунктов в меню, установите и включите этот модуль.
Модуль предоставляет интерфейс к консольным утилитам gdal.

Проекции
--------

Растровая операция запускается через меню Растр - пункт меню Проекция.

Перепроецирование
^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Проекция - Перепроецирование:

.. figure:: _static/ngqgis_reprojection.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Перепроецирование.


Пересохраняет растр в другую поддерживаемую проекцию. Есть возможность пакетной обработки. 
См. так же описание утилиты http://www.gdal.org/gdalwarp.html

Назначить проекцию
^^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Проекция - Назначить проекцию:

.. figure:: _static/ngqgis_designate_a_projection.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Назначить проекцию.

Привязать проекцию к растру, если он уже геопривязан, но отсутствует информация о проекции. <!-- Also with its help, it is possible to alter existing projection definitions.  -->
Есть возможность пакетной обработки. 

Извлечение проекцию
^^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Проекция - Извлечь проекцию:

.. figure:: _static/ngqgis_designate_a_projection.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Извлечь проекцию.



Создаёт wld-файл или prj-файл для заданного растра. Требует указания расположения 
файла на диске. Есть возможность пакетной обработки. 


Преобразование 
--------------

Операция запускается через меню Растр - пункт меню Преобразование.

Растеризация (вектор в растр)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Преобразование - Растеризация (вектор в растр):

.. figure:: _static/ngqgis_rasterization_vectors_with_raster.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Растеризация (вектор в растр).

Используется для переноса векторных данных (точки, линии, полигоны) в растровый файл. 
Векторные данные берутся из OGR-совместимого источника данных, и должны быть в той 
же системе координат, что и растр. Перепроецирование «на лету» не предусмотрено (на базе gdal_rasterize).

Векторизация (растр в вектор) 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Преобразование - Векторизация (растр в векторы):

.. figure:: _static/ngqgis_creation_of_polygons_raster_in_vectors.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Векторизация (растр в векторы).

Используется для создание векторных полигонов для всех соседних пикселей растра, имеющих 
один и тот же цвет (значение). Для каждого полигона в атрибутивную таблицу записывается 
соответствующее значение растра. Используя растровую маску, можно задать область для обработки 
(на базе gdal_polygonize).

Преобразовать формат
^^^^^^^^^^^^^^^^^^^^^^^^^

Операция запускается через меню Растр - пункт меню Преобразование - Преобразовать формат:

.. figure:: _static/ngqgis_convert_format.png
   :align: center
   :width: 12cm
 
   Инструмент для работы с растровыми данными - Преобразовать формат.


Конвертация растровых файлов между форматами. Возможно изменение системы координат, 
сжатие, задание значения NO_DATA.

Есть возможность пакетной обработки. 

RGB в PCT
^^^^^^^^^^^^^^^^^^^^^^^^^

Преобразование из цветового пространства RGB в индексированные цвета. Производится 
расчёт оптимального соответствия цветов, либо можно задать вручную количество вариантов 
цвета. Выполняется dithering. , работает пофайлово и в пакетном режиме.

PCT в RGB
^^^^^^^^^^^^^^^^^^^^^^^^^

Преобразование растра с индексированными цветами в цветовое пространство RGB. Работает 
пофайлово и в пакетном режиме (использует pct2rgb).

Извлечение
----------

Создать изолинии
^^^^^^^^^^^^^^^^^^^^^^^

Построение изолиний. Генерация изолиний по цифровой модели рельефа (DEM) (на базе gdal_contour).

Обрезка
^^^^^^^^^^^^^^^^^^^^^^^

Обрезать растр векторным слоем или по 4 координатам, или по выделенному на карте 
прямоугольнику.
Для выделения прямоугольника: нажмите Shift и левую клавишу мыши, проведите ей по 
карте. Выделение прямоугольником имеет смысл, только если в окне QGIS выставлена 
та же проекция, что у самого растра.


Анализ
------

Отсеивание
^^^^^^^^^^^^^^^^

Находит растровые полигоны с размером меньше заданного порога (в пикселях) и заменяет 
их на значение, соответствующее наибольшему соседнему растровому полигону. Результат 
отсеивания может быть записан как в существующий, так и в новый файл (использует gdal_sieve).


Сбросить в черный 
^^^^^^^^^^^^^^^^^^^^^^^^

Cканирование изображение и замена почти черных (или почти белых) пикселей возле 
рамки на пиксели с точным значением цвета. Часто используется для «коррекции» аэрофотоснимков, 
сжатых с потерями, чтобы можно было задать прозрачный цвет при создании мозаики 
(использует nearblack).


Заполнить пустоты
^^^^^^^^^^^^^^^^^^^^^^

Находит пустые растровые полигоны (обычно области NODATA), и заполняет их интерполяцией 
значений от краёв этого полигона.


Карта близости (расстояния в растре)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Строит карту близости растра, в которой указаны расстояния от центра каждого пикселя 
к центру ближайшего целевого пикселя. Целевыми пикселями будут все пиксели исходного растра, 
значения которых попадают в набор указанных величин (использует gdal_proximity).


Сетка (интерполяция)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Создает регулярную сетку (растр) на основе рассеяных данных, полученных из OGR-совместимого 
источника. Исходные даные будут интерполированы одним из доступных методов для получения 
значений узлов (на базе gdal_grid).

DEM (Анализ рельефа)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Создаёт новый растр на основе имеющегося растра с цифровой моделью рельефа (DEM).
Может строить:

1. Теневой рельеф.
2. Угол уклонов.
3. Экспозиция.
4. Цветной рельеф. 
5. Индекс пересечённости (TRI).
6. Индекс превышения (TPI).
7. Пересечённость.


Прочее
------

Создать виртуальный растр (каталог)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Создаёт файл VRT - в нём находятся ссылки на отдельные растровые файлы, а сам файл VRT 
используется как один растровый слой.

Объединение
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Склеивает несколько растровых файлов в один. Требует указания файлов.
При настройке Склеить поканально, создает один растровый файл, где каждый исходный 
файл будет отдельным слоем.

Информация
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Выводит на экран вывод утилиты gdalinfo для заданного слоя. В этой информации пишется 
система координат и охват слоя.


Построить пирамиды
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Используется для создания или восстановления уменьшенных копий изображения (пирамид). 
Наличие пирамид несколько увеличивает скорость отрисовки растра. Может работать 
пофайлово и в пакетном режиме, использует gdaladdo.
То же самое, что построение пирамид в настройках растрового слоя, но может работать пакетно.

Индекс мозаики
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Строит Shape-файл с границами растров и названиями файлов в атрибутах.
